项目经历：有数BI
1. 单点登录
2. 邮件推送，导出图片/PDF（截图任务并发控制）
3. TR日志
4. 代码覆盖率

worker问题排查


1. 熟悉JavaScript、ES6新特性
2. 熟悉Node.js、Koa框架以及常用中间件
3. 熟悉MySQL
4. 了解Docker

掌握JavaScript相关知识，理解原型与原型链、闭包、作用域链、节流与防抖等概念
熟悉ES6新特性，了解promise、async/await等基本原理




------------------------------------------
合并与扩展

schedule（日志、并发控制）

capture


一、单点登录：插件化加载机制
背景：私有化部署客户需要将有数BI接入单点登录系统
难点：1. 单点登录协议种类多样；2. 客户单点登录系统的特异化配置
成果：以代码无侵入的方式实现了单点登录。


---------------
专业技能
(1) 掌握 JavaScript、ES6 新特性。
(2) 熟悉 Node.js、Koa 框架以及常用中间件。
(3) 熟悉Java及常用容器。
(4) 了解 MySQL 数据库的存储引擎以及索引原理。
(5) 了解 Redis 的常见数据结构、过期数据的删除策略、内存淘汰机制等。
(6) 熟悉常见数据结构及算法，如快速排序、归并排序等
(7) 熟悉计算机网络，掌握HTTP、TCP/UDP等协议
(8) 了解 Docker 基本使用。




------------------------------------
一、单点登录：自助对接方式、定制化开发方式
背景：私有化部署客户希望能够使用自己的账号体系来登录有数BI
难点：1. 单点登录协议种类多样，甚至有些客户没有自己的单点系统；2. 客户特定的配置要求
解决：通过后台管理配置，提供与单点登录协议无关的对接流程，允许客户自助对接；通过插件化加载机制，提供面向具体单点登录协议的定制化开发
成果：21家客户使用自助对接方式，共节省了147人天开发时间；为33家客户做定制化开发，涵盖的单点登录协议有CAS、OAuth、OpenID Connect、SAML。

二、截图服务开发与优化
背景：数据产品需要支持导出图片/PDF、邮件推送中携带报告的图片/PDF
难点：1. 性能优化；2. 内存管理；3. 错误处理
处理：使用并发处理和浏览器实例复用提高服务的吞吐量；使用任务队列限制并发请求数量和优化资源使用来管理内存；超时处理，避免服务阻塞，返回清晰、有意义的错误信息。
成果：对内应用于网易云音乐等60+个部门，对外应用于100+大厂，提升用户体验

三、报告推送服务开发与优化
背景：方便客户定时查收系统推送的报告信息，密切跟进数据近况。
难点：1. 整点大量定时推送造成系统压力陡增；2. 服务可靠性；3. 故障排查与分析
处理：定时任务延迟10分钟发送，整点时刻仅做数据缓存，10分钟后直接使用缓存数据；引入重试机制，使用指数退避算法来处理失败重试；建立日志系统，记录推送各阶段执行情况。
成果：对内应用于网易云音乐等60+个部门，共计2100+推送，对外163环境上服务各类用户，共计1700+推送。

四、智能缓存优化
背景：数据缓存是图表性能优化最重要的手段，能有效地加快查询速度，提高用户体验
难点：1､用户行为模式的缓存优化；带默认书签的报告缓存优化
处理：基于统计数据，对用户常用行为的图表查询做缓存；查询报告的默认书签，基于用户数据权限作分组缓存
成果：缓存命中率从70% 提高到 93%+

五、工作移交机制
背景：客户希望在人员离职账号注销前，将该用户名下的资源进行责任人转交
难点：1. 涉及多种资源，每种资源处理方式不尽相同；2. 可扩展性
处理：将所有资源的处理抽象成一个统一的移交流程；每种资源的处理操作封装进一个对象，保存在一个全局Map中
成果：目前可移交资源达24种，已上线运行。








在开发导出网页截图/PDF的服务时，你需要考虑以下几个方面：
性能优化： 生成 PDF 或截图可能需要大量的计算资源，特别是在处理复杂的网页或大量请求时。因此，你需要考虑如何通过并发处理或其他手段来优化性能。
内存管理： 生成大量的 PDF 或截图可能导致内存占用过高。你需要确保及时释放资源，避免内存泄漏。
错误处理： 由于网页结构复杂多变，可能会出现各种意外情况，如元素加载失败或布局错乱。因此，你需要考虑如何处理这些错误情况，以便在用户端获得良好的体验。
安全性考虑： 如果用户可以指定要截图或转换为 PDF 的网址，你需要确保输入的安全性，避免恶意网址或攻击。
定制化需求： 有时用户可能需要自定义截图或 PDF 的样式，你需要考虑如何提供这些定制化的功能。
综上所述，性能优化、内存管理、错误处理、安全性和定制需求是你在开发导出网页截图/PDF服务时需要关注和优化的方面。

在处理性能优化时，你可以考虑以下几点：
并发处理： 使用异步编程方式，如Promise、async/await或回调函数，以便同时处理多个网页截图或PDF生成请求，从而提高服务的吞吐量。
资源重用： 保持浏览器实例的可重用性，避免在每次请求时重新启动浏览器。这可以通过连接池或类似的机制来实现。
页面优化： 在需要生成 PDF 或截图的网页上，尽量减少不必要的资源加载，优化页面结构和图片大小，以加快渲染速度。
缓存： 对于频繁请求的网页，可以考虑在生成后将结果缓存，以便在相同请求时直接返回缓存的结果，而不是重新生成。
监控和调优： 使用工具对服务进行监控，识别性能瓶颈并进行调优，以确保服务的稳定性和高性能。
通过以上方法，你可以更好地处理性能优化，提高导出网页截图/PDF服务的效率和响应速度。

在处理导出网页截图/PDF服务时的内存管理方面，你可以考虑以下几个方面：
资源释放： 在生成完截图或PDF后，确保及时释放内存和资源。关闭浏览器实例、清理临时文件或数据，以避免内存泄漏。
内存监控： 使用工具或库来监控服务的内存使用情况，及时发现内存泄漏或异常的内存占用情况。
限制并发请求： 如果内存资源有限，可以考虑限制并发请求的数量，以避免服务因内存不足而崩溃或变得不稳定。
优化资源使用： 考虑使用流式处理（streaming）来处理生成的截图或PDF，以减少对内存的压力，尤其是在处理大型文件时。
通过以上方法，你可以更好地管理内存，确保导出网页截图/PDF服务在处理大量请求时能够稳定运行，并避免内存相关的问题。

在开发导出网页截图/PDF的服务时，你可以通过以下方式来处理错误：
合理的错误信息返回： 确保服务返回清晰、有意义的错误信息，使用户或开发者能够理解问题的原因。这包括HTTP状态码、错误描述和可能的解决方案。
日志记录： 记录错误和异常情况的详细日志，包括请求参数、错误原因、堆栈跟踪等信息。这有助于诊断问题并进行后续的故障排除。
容错处理： 为服务加入容错机制，当出现错误时能够优雅地处理请求，避免因单个请求失败而影响整个服务的稳定性。
超时处理： 设置适当的请求超时时间，并处理超时情况，防止长时间等待导致服务阻塞或超负荷。
用户友好的界面反馈： 如果服务提供了用户界面，确保错误信息以易于理解的方式呈现给用户，并为用户提供帮助或解决方案。
通过以上方式，你可以更好地处理错误，提高服务的稳定性和用户体验。



开发报告推送服务时，需要考虑以下方面的难点和优化：
异步处理：确保在大规模报告推送时服务不会因为阻塞操作而变慢，可以使用异步处理或者消息队列等方式来提高并发性能。
定时任务管理：针对定时推送，需要考虑使用合适的定时任务调度器（如node-cron或者使用专门的调度服务）来确保推送任务的准确性和稳定性。
可靠性与重试机制：确保推送服务的可靠性，考虑引入重试机制以处理推送失败的情况，例如使用指数退避算法来处理失败重试。
安全性：对于邮件和webhook推送，需要确保安全性，包括对敏感数据的加密、合适的身份验证和授权机制等。
配置灵活性：提供灵活的配置选项，例如推送频率、推送目标、报告模板等，以便满足不同的业务需求。
监控与日志：建立监控和日志系统，及时发现并解决潜在的问题，以及记录推送状态和历史，以便进行故障排查和分析。
扩展性：设计服务结构，以便未来可以方便地扩展和添加新的推送方式或者报告类型。
代码优化：考虑代码的可维护性和可扩展性，遵循最佳实践，例如模块化、错误处理和文档化等。
以上这些方面都是开发报告推送服务时需要考虑的难点和需要优化的地方。



疑问：
缓存--截图能缓存吗，推送预缓存是怎么做的
智能缓存--什么时候缓存失效


1. 在网易KM上分享9篇原创文章
2. 在2022年校招易计划中获得优秀学员



基于用户行为统计的缓存优化
1. 用户行为采集与统计
2. 对图表常用行为做缓存


smartCache重启的时候会运行一次缓存（cacheRun()），之后会默认在每天零点做定时缓存
cacheRun：
清空所有队列的内容
getQueryDatas

buildCacheQueryTask
buildModelStore

cacheByCacheTaskIds: 获取报告-数据模型，以报告-数据模型为粒度进行缓存刷新
    cacheQueueManager.flushByDataModels: 遍历每个数据模型，为数据模型背后的数据源创建缓存队列（如果有了，就直接返回）
        buildCacheQueryTask: 创建缓存任务
            buildResourceStore
                buildReportStore: 创建报告的用户统计信息，并保存在map中
                buildModelStore: 获取当前数据模型所有需要缓存的数据组件以及用户数据权限分组
                    getQueryDatas
            getModelData
            buildTaskFromQueryDataConfig

        cacheQueue.add 添加缓存任务入队列


一些要点：
1. 不同数据源有不同的任务队列
2. 记录组件历史缓存信息，包括缓存次数、平均用时，失败次数。失败次数超过50次，且占比超80%，则不缓存。为了避免触发不缓存的组件永远无法缓存，会有一个超过两天清楚缓存统计信息的操作。这个清除操作只针对触发了不缓存的组件。
3. 正在执行任务队列pendingTasks，等待队列tasks，相同缓存请求拦截


cacheQueryLogDao: 记录缓存任务执行情况
cacheComponentInfoDao: 记录组件缓存信息，比如缓存次数、平均用时、失败次数

不是所有的报告都会缓存，
不是报告上的组件都会缓存

缓存有优先级之分

1. 每次用户查看报告上的图表，都会缓存此次查询
2. smartCache优化的是首次缓存命中率，即用户第一次打开报告查看图表时命中缓存的比率，目的是尽可能让用户首次打开报告也能命中缓存，提高用户体验
3. 目前有三种做法：默认配置缓存、用户热点行为缓存、默认书签缓存
4. 缓存更新：表产出消息通知有数更新相关报告组件的缓存

缓存方式，即如何做缓存：
后端模拟用户前端操作，生成一个等价的queryData，然后调用图表数据查询接口，做缓存

问题1: cache_table_task表是做什么的？mammut_catalog字段是什么意思

Redis 使用定期删除和惰性删除两种策略来删除过期数据。定期删除是指 Redis 默认每秒执行10次的随机抽样，删除设置了过期时间的键中已经过期的键。惰性删除是指在访问某个键时，Redis 会先检查该键是否过期，如果过期则会删除它。这两种策略结合起来保证了 Redis 中过期数据的及时删除。

Redis的内存淘汰机制是为了处理内存不足的情况。当内存不足时，Redis会根据配置的淘汰策略来选择要删除的键，以释放内存空间。常见的淘汰策略包括：
LRU（Least Recently Used）：删除最久没有使用的键。
LFU（Least Frequently Used）：删除访问次数最少的键。
Random（随机淘汰）：随机选择要删除的键。


-------------------------------------
邮件推送：
基本流程：每隔5分钟从数据库中查询出到期的推送，按照数据权限将推送的接收人分组，相同权限的接收人在一个分组内，接着为每一个分组生成邮件的正文和附件，然后发送邮件，最后更新推送记录的状态。

要点：
1. 整点大量定时推送优化
用户在使用定时推送的时候，通常会将推送时间设置在几个特定的整点时间，比如早上8点、9点等，这样的使用方式使得在这些时刻有大量的推送任务触发。推送处理流程中最耗时的是为邮件生成截图或PDF作为附件，截图和导出PDF需要调用截图服务完成的。截图服务使用了一个队列来控制最大并发数量，当大量的截图请求达到时，会出现任务堆积的情况，任务长时间得不到处理，就会出现接口请求超时错误，从而导致推送失败。

经过分析，截图的过程中最耗时的地方有两个：
1. 在无头浏览器中渲染图表、查询数据
2. 调用Puppeteer API获取图片数据，并将其保存在本地

因为可以将定时推送的截图分为两部分执行，在定时时间仅做数据查询，并将结果缓存下来，在10分钟后避开任务高峰期，读取缓存数据生成图片文件。

采用这种方式后，定时推送的超时失败率从10%下降到2%。

2. 自动重试机制


-------------------------------------------------------

BI整体架构

有数BI的整体架构自顶向下依次为前端绘图层、后端业务层、数据访问层和数据源层。前端绘图层负责前端图表的绘制、渲染、拖拽操作等；后端业务层处理BI的业务逻辑，直接与前端交互，提供前端需要的全部接口；数据访问层提供数据源适配，将用户在图表上的操作转换成对应数据源上的SQL语句；数据源层提供对文本数据源的特别支持，如excel、csv文件。

有数BI是一款可视化的数据分析工具，主要面向数据分析师和业务部门使用。

参与面试工作已经近10年了，面过至少2000位求职者，简单来反向讲讲面试官的取舍心理吧，只说最核心的。

首先，面试官所有的技巧，总结起来都是为了“获得更真实的答案”。所以不管是寒暄、提问、施压、套近乎，都是想尽快让你走出套路，谈点掏心窝子的东西。但是求职者往往又一直“坚持套路”，相持不下，最后就是双输局面——面试官发现剥不了洋葱，看不见真实的你，只能放弃。

其次，面试官得到他认为真实的信息后，会用一个衡量标准来匹配，这个标准就叫做“岗位胜任力模型”，一般专业一点的面试官都会使用这套工具。有的岗位是注重资历经验的，有的岗位是注重学习能力和成就动机，有的岗位是注重综合素质的，没有任何一个职位是要求所有能力都具备。

所以，我的建议就很简单了：搞清楚岗位的需求侧重，尽量诚恳地回答问题。

比如岗位本身是实习生岗位，你可以说“我认真对待每一件小事，也具备非常好的知识基础与学习能力，不足之处就是确实缺少这个岗位的实际工作经验。”这样说既坦诚，又不影响录取（这个岗位可能本身招聘的就无经验的新人。）其他花里胡哨的说法都没有必要。

如果岗位是管理岗位，你可以说“我具备比较系统实用的管理技能体系，自己也能以成就他人为目标去实施管理，可能自己以前的管理风格比较偏严格、强硬，这一点不一定适合每个团队，但我会根据实际情况去调节的。”

大概就是这样，你知道“真诚的首要性”，知道“胜任力模型的侧重原理”，就能简单轻松应对各种面试局。

但我需要补充的是，所有的面试技巧都不能超越真实性这条底线，不虚构那些你不具备的东西。这一点虽然看起来很愚蠢，实际上是非常明智的，因为如果一份工作所需要的胜任力实际上你不具备，你也会浪费很多时间与机会成本。

希望对大家有些帮助。


schedule：定时调度、市面上的定时调度组件、代码覆盖率、任务重试、

日志：采集、分析

短期1、把自己捯饬干净整洁，跟去相亲一样2、面试中不要着急回答，不要着急回答，不要着急回答。把问题的条件、各方面问清楚。3、遇到不会的问题，摆出一副分析的架势，先学会穷举。再逐步分析你能想到的所有可能的情况和不可能的情况
长期1、永远不要放弃基础的能力训练。1）写代码的能力保持持续的写。除了做日常工作，别只动口不动手。还可以把新学到的东西都用写demo的方式写出来。2）聪明程度，或者说逻辑思维能力枕边常备算法书，有空就看几个题。关注一些算法公众号，被动的熟悉熟悉。2、经验积累。做过的项目，挖掘项目中的难点，总结自己怎么做的，别人（特指行业内有代表性的公司和人）怎么做的，有什么差异。面试中就考察这些。各大厂都有公众号，关注了解。也可以去知乎、google搜索。不要做了一个项目跟没做一样，没有总结就没有进步。3、关注新技术勤奋好学是长期来看最重要的竞争力。在自己的领域，什么新技术出现了，不管用不用得到，先了解，写demo，至少要知道。深入一点可以会用。再深入一点，可以理解原理，会实现继续深入，就可以发现问题做优化，做出先进的东西


虚假的危机感:

我要保持技术知识的新鲜度, 这样我就能不被裁员

真实的危机感:

行业趋势和大环境导致了, 这个岗位的不稳定性, 我一定要趁早找到其他出路